---
import Layout from "../../../layouts/Layout.astro";
import * as postRepository from "../../../repositories/posts.astro";

import { Icon } from "astro-icon";
import Giscus from "../../../components/Giscus.astro";
import Breadcrumb from "../../../components/Breadcrumb.astro";
import type { BreadcrumbElement } from "../../../components/Breadcrumb.astro";

export async function getStaticPaths() {
  const posts = await postRepository.all();

  return posts.map((post) => {
    return {
      params: {
        created_at: post.postRef.created_at,
        slug: post.postRef.slug,
      },
      props: {
        post,
      },
    };
  });
}

const { created_at, slug } = Astro.params;
const { post } = Astro.props;
const { frontmatter } = post;

const Content = post.Content;

const breadcrumbs: BreadcrumbElement[] = [
  {
    icon: 'folder',
    url: '/blog',
    text: 'Blog',
  },
  {
    icon: 'folder',
    url: `/blog/${created_at}/${slug}/`,
    text: frontmatter.title as string,
  }
];
---

<Layout title={frontmatter.title}>
  <Breadcrumb class="px-2" breadcrumbs={breadcrumbs} />
  <div class="prose lg:prose-xl px-4 mx-auto my-12">
    <h1 class="text-4xl font-bold text-center my-8">{frontmatter.title}</h1>
    <div class="flex justify-center items-center mb-16">
      <Icon class="inline mr-1" pack="codicon" name="calendar" size={16} />
      <span>{post.created_at}</span>
    </div>
    <section>
      <Content components={{ h2: 'h3' }} />
    </section>
    <div class="divider my-20">Comments</div>
    <section class="my-6">
      <Giscus />
    </section>
  </div>
</Layout>

<style is:global>
  img {
    @apply p-6;
    @apply rounded-lg shadow-md;
  }
</style>